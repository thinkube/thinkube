#!/bin/bash
# Image identifier for organizing examples
IMAGE_NAME="{{ image_name }}"

# Create symlink to read-only templates (always fresh from image)
if [ ! -L "/home/jovyan/notebooks/templates" ]; then
  echo "Creating symlink to read-only templates..."
  ln -s /opt/thinkube/examples /home/jovyan/notebooks/templates
fi

# Copy examples to image-specific folder (allows multiple images to coexist)
if [ ! -f "/home/jovyan/notebooks/examples/${IMAGE_NAME}/.copied" ] && [ -d "/opt/thinkube/examples" ]; then
  echo "Copying editable example notebooks to examples/${IMAGE_NAME}/..."
  mkdir -p "/home/jovyan/notebooks/examples/${IMAGE_NAME}"
  cp -r /opt/thinkube/examples/* "/home/jovyan/notebooks/examples/${IMAGE_NAME}/" 2>/dev/null || true
  touch "/home/jovyan/notebooks/examples/${IMAGE_NAME}/.copied"
fi

# Start whatever command was passed (jupyterhub-singleuser when spawned by hub, jupyter lab for standalone)
exec "$@"