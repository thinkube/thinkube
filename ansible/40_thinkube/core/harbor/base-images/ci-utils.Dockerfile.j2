# Copyright 2025 Alejandro Martínez Corriá and the Thinkube contributors
# SPDX-License-Identifier: Apache-2.0

# Lightweight CI/CD utilities image with curl and common tools
FROM library/alpine:3.19

# Install commonly needed CI/CD tools
RUN apk add --no-cache \
    # Essential tools
    curl \
    wget \
    git \
    bash \
    # JSON/YAML processing
    jq \
    yq \
    # Text processing (grep, sed, awk are in busybox)
    # Network tools
    openssh-client \
    ca-certificates \
    # Build essentials
    make \
    # Archive tools (tar, gzip in busybox)
    unzip

# Add a non-root user for security
RUN adduser -D -s /bin/bash ci-user

# Set bash as default shell
SHELL ["/bin/bash", "-c"]

# Create workspace directory
WORKDIR /workspace

# Default to non-root user
USER ci-user

# Health check command
HEALTHCHECK NONE

# Default command
CMD ["/bin/bash"]