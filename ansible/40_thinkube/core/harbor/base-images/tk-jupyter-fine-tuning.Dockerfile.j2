# Copyright 2025 Alejandro Mart√≠nez Corri√° and the Thinkube contributors
# SPDX-License-Identifier: Apache-2.0

# Jupyter Fine-Tuning Lab - LLM fine-tuning environment with Unsloth and QLoRA
# Base: jupyter-ml-gpu (CUDA 12.6 + PyTorch)
# Includes: Unsloth, bitsandbytes, PEFT, TRL for efficient LLM fine-tuning

FROM {{ harbor_registry }}/library/tk-jupyter-ml-gpu:latest

USER jovyan

# Install LLM fine-tuning packages
RUN python -m pip install --no-cache-dir --user \
    unsloth==2025.9.9 \
    bitsandbytes==0.47.0 \
    peft==0.17.1 \
    trl==0.23.0

# All Thinkube service clients are inherited from base image

# Note: ENTRYPOINT and startup script are inherited from base image
# But we need to override with our image name
USER root
COPY startup.sh /usr/local/bin/startup.sh
RUN chmod +x /usr/local/bin/startup.sh
USER jovyan

# ü§ñ AI-assisted