# Copyright 2025 Alejandro Mart√≠nez Corri√° and the Thinkube contributors
# SPDX-License-Identifier: Apache-2.0

---
# ansible/40_thinkube/optional/chroma/00_install.yaml
# Description:
#   Orchestrator playbook for Chroma vector database installation
#   This playbook calls the individual playbooks in the correct order
#
# Requirements:
#   - MicroK8s must be installed and running
#   - ADMIN_PASSWORD environment variable must be set
#
# Usage:
#   cd ~/thinkube
#   ./scripts/run_ansible.sh ansible/40_thinkube/optional/chroma/00_install.yaml
#
# ü§ñ AI-assisted

- name: Install Chroma Vector Database
  hosts: microk8s_control_plane
  gather_facts: false

  tasks:
    - name: Deploy Chroma
      ansible.builtin.include_tasks:
        file: 10_deploy.yaml
        apply:
          tags: always

    - name: Configure service discovery
      ansible.builtin.include_tasks:
        file: 17_configure_discovery.yaml
        apply:
          tags: always

    - name: Installation complete
      ansible.builtin.debug:
        msg: |
          Chroma vector database has been successfully installed!

          Access the API at: https://chroma.{{ domain_name }}

          Authentication: Token-based (using admin credentials)

          To test the installation:
          ./scripts/run_ansible.sh ansible/40_thinkube/optional/chroma/18_test.yaml